!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){var r=t;r.type=function(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")},r.isArray=function(e){return"Array"===r.type(e)},r.slice=function(e,t){return Array.prototype.slice.call(e,t)},r.truthy=function(e){return!!e},r.isString=function(e){return"String"===r.type(e)},r.each=function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)},r.toArray=function(e){if(!e)return[];for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},r.setAttr=function(e,t,r){switch(t){case"style":e.style.cssText=r;break;case"value":var n=e.tagName||"";"input"===(n=n.toLowerCase())||"textarea"===n?e.value=r:e.setAttribute(t,r);break;default:e.setAttribute(t,r)}}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),i=0,a=1,l=2,c=3;function s(e,t){!function e(t,r,n){var s=n[r.index];var u=t.childNodes?t.childNodes.length:0;for(var f=0;f<u;f++){var p=t.childNodes[f];r.index++,e(p,r,n)}s&&function(e,t){o.a.each(t,function(t){switch(t.type){case i:var r="string"==typeof t.node?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(r,e);break;case a:!function(e,t){var r=o.a.toArray(e.childNodes),n={};o.a.each(r,function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(n[t]=e)}}),o.a.each(t,function(t){var o=t.index;if(0===t.type)r[o]===e.childNodes[o]&&e.removeChild(e.childNodes[o]),r.splice(o,1);else if(1===t.type){var i=n[t.item.key]?n[t.item.key].cloneNode(!0):"object"==typeof t.item?t.item.render():document.createTextNode(t.item);r.splice(o,0,i),e.insertBefore(i,e.childNodes[o]||null)}})}(e,t.moves);break;case l:!function(e,t){for(var r in t)if(void 0===t[r])e.removeAttribute(r);else{var n=t[r];o.a.setAttr(e,r,n)}}(e,t.props);break;case c:e.textContent?e.textContent=t.content:e.nodeValue=t.content;break;default:throw new Error("Unknown patch type "+t.type)}})}(t,s)}(e,{index:0},t)}s.REPLACE=i,s.REORDER=a,s.PROPS=l,s.TEXT=c;var u=s;function f(e,t){for(var r={},n=[],o=0,i=e.length;o<i;o++){var a=e[o],l=p(a,t);l?r[l]=o:n.push(a)}return{keyIndex:r,free:n}}function p(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}function d(e,t,r,n){var i,a=[];if(null===t);else if(o.a.isString(e)&&o.a.isString(t))t!==e&&a.push({type:u.TEXT,content:t});else if(e.tagName===t.tagName&&e.key===t.key){var l=function(e,t){var r,n,o=0,i=e.props,a=t.props,l={};for(r in i)n=i[r],a[r]!==n&&(o++,l[r]=a[r]);for(r in a)n=a[r],i.hasOwnProperty(r)||(o++,l[r]=a[r]);if(0===o)return null;return l}(e,t);l&&a.push({type:u.PROPS,props:l}),(i=t).props&&i.props.hasOwnProperty("ignore")||function(e,t,r,n,i){var a=function(e,t,r){for(var n,o,i=f(e,r),a=f(t,r),l=a.free,c=i.keyIndex,s=a.keyIndex,u=[],d=[],h=0,y=0;h<e.length;){if(o=p(n=e[h],r))if(s.hasOwnProperty(o)){var v=s[o];d.push(t[v])}else d.push(null);else{var g=l[y++];d.push(g||null)}h++}var m=d.slice(0);for(console.log("children",d),h=0;h<m.length;)null===m[h]?(A(h),E(h)):h++;console.log("simulateList",m);for(var k=h=0;h<t.length;){o=p(n=t[h],r);var b=m[h],x=p(b,r);b?o===x?k++:c.hasOwnProperty(o)&&p(m[k+1],r)===o?(A(h),E(k),k++):w(h,n):w(h,n),h++}for(var N=m.length-k;k++<m.length;)A(--N+h);function A(e){var t={index:e,type:0};u.push(t)}function w(e,t){var r={index:e,item:t,type:1};u.push(r)}function E(e){m.splice(e,1)}return{moves:u,children:d}}(e,t,"key");if(t=a.children,a.moves.length){var l={type:u.REORDER,moves:a.moves};i.push(l)}var c=null,s=r;o.a.each(e,function(e,r){var o=t[r];s=c&&c.count?s+c.count+1:s+1,d(e,o,s,n),c=e})}(e.children,t.children,r,n,a)}else a.push({type:u.REPLACE,node:t});a.length&&(n[r]=a)}var h=function(e,t){var r={};return d(e,t,0,r),r};function y(e,t,r){if(!(this instanceof y))return o.a.isArray(r)||null==r||(r=o.a.slice(arguments,2).filter(o.a.truthy)),new y(e,t,r);o.a.isArray(t)&&(r=t,t={}),this.tagName=e,this.props=t||{},this.children=r||[],this.key=t?t.key:void 0;var n=0;o.a.each(this.children,function(e,t){e instanceof y?n+=e.count:r[t]=""+e,n++}),this.count=n}y.prototype.render=function(){var e=document.createElement(this.tagName),t=this.props;for(var r in t){var n=t[r];o.a.setAttr(e,r,n)}return o.a.each(this.children,function(t){var r=t instanceof y?t.render():document.createTextNode(t);e.appendChild(r)}),e};var v=y;let g=v("li",{key:"d",style:"color: red"},["li#d"]),m=(v("li",{key:"e",style:"color:green"},["li#e"]),v("li",{key:"a",style:"color: blue"},["li#a"])),k=v("li",{key:"b",style:"color: yellow"},["li#b"]),b=v("li",{key:"c",style:"color: orange"},["li#c"]),x=(v("li",{key:"f",style:"color: purple"},["li#f"]),v("ul",{key:"old"},[m,k,b,g])),N=v("ul",{key:"old"},[g,m,k,b]);var A=x.render();document.body.appendChild(A),console.time("start");var w=h(x,N);console.log(w),u(A,w),console.timeEnd("start")}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWwuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhdGNoLmpzIiwid2VicGFjazovLy8uL3NyYy9saXN0LWRpZmYuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2RpZmYuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2VsZW1lbnQuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJfIiwidHlwZSIsIm9iaiIsInRvU3RyaW5nIiwicmVwbGFjZSIsImlzQXJyYXkiLCJsaXN0Iiwic2xpY2UiLCJhcnJheUxpa2UiLCJpbmRleCIsIkFycmF5IiwidHJ1dGh5IiwiaXNTdHJpbmciLCJlYWNoIiwiYXJyYXkiLCJmbiIsImxlbiIsImxlbmd0aCIsInRvQXJyYXkiLCJsaXN0TGlrZSIsInB1c2giLCJzZXRBdHRyIiwibm9kZSIsImtleSIsInN0eWxlIiwiY3NzVGV4dCIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsInNldEF0dHJpYnV0ZSIsIlJFUExBQ0UiLCJSRU9SREVSIiwiUFJPUFMiLCJURVhUIiwicGF0Y2giLCJwYXRjaGVzIiwiZGZzV2FsayIsIndhbGtlciIsImN1cnJlbnRQYXRjaGVzIiwiY2hpbGROb2RlcyIsImNoaWxkIiwidXRpbF9kZWZhdWx0IiwiYSIsImN1cnJlbnRQYXRjaCIsIm5ld05vZGUiLCJkb2N1bWVudCIsImNyZWF0ZVRleHROb2RlIiwicmVuZGVyIiwicGFyZW50Tm9kZSIsInJlcGxhY2VDaGlsZCIsIm1vdmVzIiwic3RhdGljTm9kZUxpc3QiLCJtYXBzIiwibm9kZVR5cGUiLCJnZXRBdHRyaWJ1dGUiLCJtb3ZlIiwicmVtb3ZlQ2hpbGQiLCJzcGxpY2UiLCJpbnNlcnROb2RlIiwiaXRlbSIsImNsb25lTm9kZSIsImluc2VydEJlZm9yZSIsInJlb3JkZXJDaGlsZHJlbiIsInByb3BzIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0UHJvcHMiLCJ0ZXh0Q29udGVudCIsImNvbnRlbnQiLCJub2RlVmFsdWUiLCJFcnJvciIsImFwcGx5UGF0Y2hlcyIsInNyY19wYXRjaCIsIm1ha2VLZXlJbmRleEFuZEZyZWUiLCJrZXlJbmRleCIsImZyZWUiLCJpdGVtS2V5IiwiZ2V0SXRlbUtleSIsImRpZmZfZGZzV2FsayIsIm9sZE5vZGUiLCJwcm9wc1BhdGNoZXMiLCJjb3VudCIsIm9sZFByb3BzIiwibmV3UHJvcHMiLCJkaWZmUHJvcHMiLCJvbGRDaGlsZHJlbiIsIm5ld0NoaWxkcmVuIiwiZGlmZnMiLCJvbGRMaXN0IiwibmV3TGlzdCIsIm9sZE1hcCIsIm5ld01hcCIsIm5ld0ZyZWUiLCJvbGRLZXlJbmRleCIsIm5ld0tleUluZGV4IiwiY2hpbGRyZW4iLCJmcmVlSW5kZXgiLCJuZXdJdGVtSW5kZXgiLCJmcmVlSXRlbSIsInNpbXVsYXRlTGlzdCIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmUiLCJyZW1vdmVTaW11bGF0ZSIsImoiLCJzaW11bGF0ZUl0ZW0iLCJzaW11bGF0ZUl0ZW1LZXkiLCJpbnNlcnQiLCJrIiwibGlzdERpZmYiLCJyZW9yZGVyUGF0Y2giLCJsZWZ0Tm9kZSIsImN1cnJlbnROb2RlSW5kZXgiLCJuZXdDaGlsZCIsImRpZmZDaGlsZHJlbiIsInNyY19kaWZmIiwib2xkVHJlZSIsIm5ld1RyZWUiLCJFbGVtZW50IiwidGhpcyIsImFyZ3VtZW50cyIsImZpbHRlciIsInVuZGVmaW5lZCIsImVsIiwiY3JlYXRlRWxlbWVudCIsInByb3BOYW1lIiwicHJvcFZhbHVlIiwiY2hpbGRFbCIsImFwcGVuZENoaWxkIiwic3JjX2VsZW1lbnQiLCJsaWQiLCJsaWEiLCJsaWIiLCJsaWMiLCJyb290IiwiYm9keSIsInRpbWUiLCJzcmNfcGF0Y2hlcyIsInRpbWVFbmQiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUNBSyxjQUFBLEVBQ0FDLFlBQUEsRUFDQUMsSUFBQU4sS0FNQVosRUFBQW1CLEVBQUEsU0FBQWpCLEdBQ0FZLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURrQixPQUFBLEtBSWpEcEIsRUFBQXFCLEVBQUEsU0FBQWxCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQW1CLFdBQ0EsV0FBMkIsT0FBQW5CLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFVLEVBQUFDLEdBQXNELE9BQUFWLE9BQUFXLFVBQUFDLGVBQUFuQixLQUFBZ0IsRUFBQUMsSUFHdER4QixFQUFBMkIsRUFBQSxHQUlBM0IsSUFBQTRCLEVBQUEsbUJDbkVBLElBQUlDLEVBQUkzQixFQUVSMkIsRUFBRUMsS0FBTyxTQUFVQyxHQUNqQixPQUFP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TixHQUM1QmtGLEVBQUdLLFlBQVlELEtBR1ZKLEdBR1QsSUFBQU0sRUFBQSxFQzdEQSxJQUFJQyxFQUFNRCxFQUFHLE1BQVF4RyxJQUFLLElBQUtDLE1BQU8sZUFBaUIsU0FFbkR5RyxHQURNRixFQUFHLE1BQVF4RyxJQUFLLElBQUtDLE1BQU8sZ0JBQWtCLFNBQzlDdUcsRUFBRyxNQUFReEcsSUFBSyxJQUFLQyxNQUFPLGdCQUFrQixVQUNwRDBHLEVBQU1ILEVBQUcsTUFBUXhHLElBQUssSUFBS0MsTUFBTyxrQkFBb0IsU0FDdEQyRyxFQUFNSixFQUFHLE1BQVF4RyxJQUFLLElBQUtDLE1BQU8sa0JBQW9CLFNBR3REMEYsR0FGTWEsRUFBRyxNQUFReEcsSUFBSyxJQUFLQyxNQUFPLGtCQUFvQixTQUU1Q3VHLEVBQUcsTUFBUXhHLElBQUssUUFBVTBHLEVBQUtDLEVBQUtDLEVBQUtILEtBQ25EYixFQUFVWSxFQUFHLE1BQVF4RyxJQUFLLFFBQVV5RyxFQUFLQyxFQUFLQyxFQUFLQyxJQUV2RCxJQUFJQyxFQUFPbEIsRUFBUXBFLFNBQ25CRixTQUFTeUYsS0FBS1AsWUFBWU0sR0FHMUJsQyxRQUFRb0MsS0FBSyxTQUNiLElBQUlDLEVBQVV0QixFQUFLQyxFQUFTQyxHQUM1QmpCLFFBQVFDLElBQUlvQyxHQUNaakUsRUFBTThELEVBQU1HLEdBQ1pyQyxRQUFRc0MsUUFBUSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwidmFyIF8gPSBleHBvcnRzXG5cbl8udHlwZSA9IGZ1bmN0aW9uIChvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopLnJlcGxhY2UoL1xcW29iamVjdFxcc3xcXF0vZywgJycpXG59XG5cbl8uaXNBcnJheSA9IGZ1bmN0aW9uIGlzQXJyYXkgKGxpc3QpIHtcbiAgcmV0dXJuIF8udHlwZShsaXN0KSA9PT0gJ0FycmF5J1xufVxuXG5fLnNsaWNlID0gZnVuY3Rpb24gc2xpY2UgKGFycmF5TGlrZSwgaW5kZXgpIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5TGlrZSwgaW5kZXgpXG59XG5cbl8udHJ1dGh5ID0gZnVuY3Rpb24gdHJ1dGh5ICh2YWx1ZSkge1xuICByZXR1cm4gISF2YWx1ZVxufVxuXG5fLmlzU3RyaW5nID0gZnVuY3Rpb24gaXNTdHJpbmcgKGxpc3QpIHtcbiAgcmV0dXJuIF8udHlwZShsaXN0KSA9PT0gJ1N0cmluZydcbn1cblxuXy5lYWNoID0gZnVuY3Rpb24gZWFjaCAoYXJyYXksIGZuKSB7XG4gIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGZuKGFycmF5W2ldLCBpKVxuICB9XG59XG5cbl8udG9BcnJheSA9IGZ1bmN0aW9uIHRvQXJyYXkgKGxpc3RMaWtlKSB7XG4gIGlmICghbGlzdExpa2UpIHtcbiAgICByZXR1cm4gW11cbiAgfVxuXG4gIHZhciBsaXN0ID0gW11cblxuICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdExpa2UubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBsaXN0LnB1c2gobGlzdExpa2VbaV0pXG4gIH1cblxuICByZXR1cm4gbGlzdFxufVxuXG5fLnNldEF0dHIgPSBmdW5jdGlvbiBzZXRBdHRyIChub2RlLCBrZXksIHZhbHVlKSB7XG4gIHN3aXRjaCAoa2V5KSB7XG4gICAgY2FzZSAnc3R5bGUnOlxuICAgICAgbm9kZS5zdHlsZS5jc3NUZXh0ID0gdmFsdWVcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAndmFsdWUnOlxuICAgICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUgfHwgJydcbiAgICAgIHRhZ05hbWUgPSB0YWdOYW1lLnRvTG93ZXJDYXNlKClcbiAgICAgIGlmIChcbiAgICAgICAgdGFnTmFtZSA9PT0gJ2lucHV0JyB8fCB0YWdOYW1lID09PSAndGV4dGFyZWEnXG4gICAgICApIHtcbiAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpZiBpdCBpcyBub3QgYSBpbnB1dCBvciB0ZXh0YXJlYSwgdXNlIGBzZXRBdHRyaWJ1dGVgIHRvIHNldFxuICAgICAgICBub2RlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKVxuICAgICAgfVxuICAgICAgYnJlYWtcbiAgICBkZWZhdWx0OlxuICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSlcbiAgICAgIGJyZWFrXG4gIH1cbn1cbiIsImltcG9ydCBfIGZyb20gJy4vdXRpbCdcblxudmFyIFJFUExBQ0UgPSAwXG52YXIgUkVPUkRFUiA9IDFcbnZhciBQUk9QUyA9IDJcbnZhciBURVhUID0gM1xuXG5mdW5jdGlvbiBwYXRjaChub2RlLCBwYXRjaGVzKSB7XG4gIHZhciB3YWxrZXIgPSB7IGluZGV4OiAwIH1cbiAgZGZzV2Fsayhub2RlLCB3YWxrZXIsIHBhdGNoZXMpXG59XG5cbmZ1bmN0aW9uIGRmc1dhbGsobm9kZSwgd2Fsa2VyLCBwYXRjaGVzKSB7XG4gIHZhciBjdXJyZW50UGF0Y2hlcyA9IHBhdGNoZXNbd2Fsa2VyLmluZGV4XVxuXG4gIHZhciBsZW4gPSBub2RlLmNoaWxkTm9kZXMgPyBub2RlLmNoaWxkTm9kZXMubGVuZ3RoIDogMFxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgdmFyIGNoaWxkID0gbm9kZS5jaGlsZE5vZGVzW2ldXG4gICAgd2Fsa2VyLmluZGV4KytcbiAgICBkZnNXYWxrKGNoaWxkLCB3YWxrZXIsIHBhdGNoZXMpXG4gIH1cblxuICBpZiAoY3VycmVudFBhdGNoZXMpIHtcbiAgICBhcHBseVBhdGNoZXMobm9kZSwgY3VycmVudFBhdGNoZXMpXG4gIH1cbn1cblxuZnVuY3Rpb24gYXBwbHlQYXRjaGVzKG5vZGUsIGN1cnJlbnRQYXRjaGVzKSB7XG4gIF8uZWFjaChjdXJyZW50UGF0Y2hlcywgZnVuY3Rpb24oY3VycmVudFBhdGNoKSB7XG4gICAgc3dpdGNoIChjdXJyZW50UGF0Y2gudHlwZSkge1xuICAgICAgY2FzZSBSRVBMQUNFOlxuICAgICAgICB2YXIgbmV3Tm9kZSA9XG4gICAgICAgICAgdHlwZW9mIGN1cnJlbnRQYXRjaC5ub2RlID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgPyBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjdXJyZW50UGF0Y2gubm9kZSlcbiAgICAgICAgICAgIDogY3VycmVudFBhdGNoLm5vZGUucmVuZGVyKClcbiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdOb2RlLCBub2RlKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBSRU9SREVSOlxuICAgICAgICByZW9yZGVyQ2hpbGRyZW4obm9kZSwgY3VycmVudFBhdGNoLm1vdmVzKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBQUk9QUzpcbiAgICAgICAgc2V0UHJvcHMobm9kZSwgY3VycmVudFBhdGNoLnByb3BzKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBURVhUOlxuICAgICAgICBpZiAobm9kZS50ZXh0Q29udGVudCkge1xuICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSBjdXJyZW50UGF0Y2guY29udGVudFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGZ1Y2sgaWVcbiAgICAgICAgICBub2RlLm5vZGVWYWx1ZSA9IGN1cnJlbnRQYXRjaC5jb250ZW50XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBwYXRjaCB0eXBlICcgKyBjdXJyZW50UGF0Y2gudHlwZSlcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHNldFByb3BzKG5vZGUsIHByb3BzKSB7XG4gIGZvciAodmFyIGtleSBpbiBwcm9wcykge1xuICAgIGlmIChwcm9wc1trZXldID09PSB2b2lkIDY2Nikge1xuICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoa2V5KVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdmFsdWUgPSBwcm9wc1trZXldXG4gICAgICBfLnNldEF0dHIobm9kZSwga2V5LCB2YWx1ZSlcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVvcmRlckNoaWxkcmVuKG5vZGUsIG1vdmVzKSB7XG4gIHZhciBzdGF0aWNOb2RlTGlzdCA9IF8udG9BcnJheShub2RlLmNoaWxkTm9kZXMpXG4gIHZhciBtYXBzID0ge31cblxuICBfLmVhY2goc3RhdGljTm9kZUxpc3QsIGZ1bmN0aW9uKG5vZGUpIHtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgdmFyIGtleSA9IG5vZGUuZ2V0QXR0cmlidXRlKCdrZXknKVxuICAgICAgaWYgKGtleSkge1xuICAgICAgICBtYXBzW2tleV0gPSBub2RlXG4gICAgICB9XG4gICAgfVxuICB9KVxuXG4gIF8uZWFjaChtb3ZlcywgZnVuY3Rpb24obW92ZSkge1xuICAgIHZhciBpbmRleCA9IG1vdmUuaW5kZXhcbiAgICBpZiAobW92ZS50eXBlID09PSAwKSB7XG4gICAgICAvLyByZW1vdmUgaXRlbVxuICAgICAgaWYgKHN0YXRpY05vZGVMaXN0W2luZGV4XSA9PT0gbm9kZS5jaGlsZE5vZGVzW2luZGV4XSkge1xuICAgICAgICAvLyBtYXliZSBoYXZlIGJlZW4gcmVtb3ZlZCBmb3IgaW5zZXJ0aW5nXG4gICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5jaGlsZE5vZGVzW2luZGV4XSlcbiAgICAgIH1cbiAgICAgIHN0YXRpY05vZGVMaXN0LnNwbGljZShpbmRleCwgMSlcbiAgICB9IGVsc2UgaWYgKG1vdmUudHlwZSA9PT0gMSkge1xuICAgICAgLy8gaW5zZXJ0IGl0ZW1cbiAgICAgIHZhciBpbnNlcnROb2RlID0gbWFwc1ttb3ZlLml0ZW0ua2V5XVxuICAgICAgICA/IG1hcHNbbW92ZS5pdGVtLmtleV0uY2xvbmVOb2RlKHRydWUpIC8vIHJldXNlIG9sZCBpdGVtXG4gICAgICAgIDogdHlwZW9mIG1vdmUuaXRlbSA9PT0gJ29iamVjdCdcbiAgICAgICAgICA/IG1vdmUuaXRlbS5yZW5kZXIoKVxuICAgICAgICAgIDogZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobW92ZS5pdGVtKVxuICAgICAgc3RhdGljTm9kZUxpc3Quc3BsaWNlKGluZGV4LCAwLCBpbnNlcnROb2RlKVxuICAgICAgbm9kZS5pbnNlcnRCZWZvcmUoaW5zZXJ0Tm9kZSwgbm9kZS5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKVxuICAgIH1cbiAgfSlcbn1cblxucGF0Y2guUkVQTEFDRSA9IFJFUExBQ0VcbnBhdGNoLlJFT1JERVIgPSBSRU9SREVSXG5wYXRjaC5QUk9QUyA9IFBST1BTXG5wYXRjaC5URVhUID0gVEVYVFxuXG5leHBvcnQgZGVmYXVsdCBwYXRjaFxuIiwiLyoqXHJcbiAqIERpZmYgdHdvIGxpc3QgaW4gTyhOKS5cclxuICogQHBhcmFtIHtBcnJheX0gb2xkTGlzdCAtIE9yaWdpbmFsIExpc3RcclxuICogQHBhcmFtIHtBcnJheX0gbmV3TGlzdCAtIExpc3QgQWZ0ZXIgY2VydGFpbiBpbnNlcnRpb25zLCByZW1vdmVzLCBvciBtb3Zlc1xyXG4gKiBAcmV0dXJuIHtPYmplY3R9IC0ge21vdmVzOiA8QXJyYXk+fVxyXG4gKiAgICAgICAgICAgICAgICAgIC0gbW92ZXMgaXMgYSBsaXN0IG9mIGFjdGlvbnMgdGhhdCB0ZWxsaW5nIGhvdyB0byByZW1vdmUgYW5kIGluc2VydFxyXG4gKi9cclxuZnVuY3Rpb24gbGlzdERpZmYob2xkTGlzdCwgbmV3TGlzdCwga2V5KSB7XHJcbiAgdmFyIG9sZE1hcCA9IG1ha2VLZXlJbmRleEFuZEZyZWUob2xkTGlzdCwga2V5KVxyXG4gIHZhciBuZXdNYXAgPSBtYWtlS2V5SW5kZXhBbmRGcmVlKG5ld0xpc3QsIGtleSlcclxuXHJcbiAgdmFyIG5ld0ZyZWUgPSBuZXdNYXAuZnJlZVxyXG5cclxuICB2YXIgb2xkS2V5SW5kZXggPSBvbGRNYXAua2V5SW5kZXhcclxuICB2YXIgbmV3S2V5SW5kZXggPSBuZXdNYXAua2V5SW5kZXhcclxuXHJcbiAgdmFyIG1vdmVzID0gW11cclxuXHJcbiAgLy8gYSBzaW11bGF0ZSBsaXN0IHRvIG1hbmlwdWxhdGVcclxuICB2YXIgY2hpbGRyZW4gPSBbXVxyXG4gIHZhciBpID0gMFxyXG4gIHZhciBpdGVtXHJcbiAgdmFyIGl0ZW1LZXlcclxuICB2YXIgZnJlZUluZGV4ID0gMFxyXG5cclxuICAvLyBmaXJzdCBwYXNzIHRvIGNoZWNrIGl0ZW0gaW4gb2xkIGxpc3Q6IGlmIGl0J3MgcmVtb3ZlZCBvciBub3RcclxuICB3aGlsZSAoaSA8IG9sZExpc3QubGVuZ3RoKSB7XHJcbiAgICBpdGVtID0gb2xkTGlzdFtpXVxyXG4gICAgaXRlbUtleSA9IGdldEl0ZW1LZXkoaXRlbSwga2V5KVxyXG4gICAgaWYgKGl0ZW1LZXkpIHtcclxuICAgICAgaWYgKCFuZXdLZXlJbmRleC5oYXNPd25Qcm9wZXJ0eShpdGVtS2V5KSkge1xyXG4gICAgICAgIGNoaWxkcmVuLnB1c2gobnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgbmV3SXRlbUluZGV4ID0gbmV3S2V5SW5kZXhbaXRlbUtleV1cclxuICAgICAgICBjaGlsZHJlbi5wdXNoKG5ld0xpc3RbbmV3SXRlbUluZGV4XSlcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFyIGZyZWVJdGVtID0gbmV3RnJlZVtmcmVlSW5kZXgrK11cclxuICAgICAgY2hpbGRyZW4ucHVzaChmcmVlSXRlbSB8fCBudWxsKVxyXG4gICAgfVxyXG4gICAgaSsrXHJcbiAgfVxyXG5cclxuICB2YXIgc2ltdWxhdGVMaXN0ID0gY2hpbGRyZW4uc2xpY2UoMClcclxuICBjb25zb2xlLmxvZygnY2hpbGRyZW4nLCBjaGlsZHJlbilcclxuICAvLyByZW1vdmUgaXRlbXMgbm8gbG9uZ2VyIGV4aXN0XHJcbiAgaSA9IDBcclxuICB3aGlsZSAoaSA8IHNpbXVsYXRlTGlzdC5sZW5ndGgpIHtcclxuICAgIGlmIChzaW11bGF0ZUxpc3RbaV0gPT09IG51bGwpIHtcclxuICAgICAgcmVtb3ZlKGkpXHJcbiAgICAgIHJlbW92ZVNpbXVsYXRlKGkpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpKytcclxuICAgIH1cclxuICB9XHJcbiAgY29uc29sZS5sb2coJ3NpbXVsYXRlTGlzdCcsIHNpbXVsYXRlTGlzdClcclxuICAvLyBpIGlzIGN1cnNvciBwb2ludGluZyB0byBhIGl0ZW0gaW4gbmV3IGxpc3RcclxuICAvLyBqIGlzIGN1cnNvciBwb2ludGluZyB0byBhIGl0ZW0gaW4gc2ltdWxhdGVMaXN0XHJcbiAgdmFyIGogPSAoaSA9IDApXHJcbiAgd2hpbGUgKGkgPCBuZXdMaXN0Lmxlbmd0aCkge1xyXG4gICAgaXRlbSA9IG5ld0xpc3RbaV1cclxuICAgIGl0ZW1LZXkgPSBnZXRJdGVtS2V5KGl0ZW0sIGtleSlcclxuXHJcbiAgICB2YXIgc2ltdWxhdGVJdGVtID0gc2ltdWxhdGVMaXN0W2ldXHJcbiAgICB2YXIgc2ltdWxhdGVJdGVtS2V5ID0gZ2V0SXRlbUtleShzaW11bGF0ZUl0ZW0sIGtleSlcclxuXHJcbiAgICBpZiAoc2ltdWxhdGVJdGVtKSB7XHJcbiAgICAgIGlmIChpdGVtS2V5ID09PSBzaW11bGF0ZUl0ZW1LZXkpIHtcclxuICAgICAgICBqKytcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBuZXcgaXRlbSwganVzdCBpbmVzcnQgaXRcclxuICAgICAgICBpZiAoIW9sZEtleUluZGV4Lmhhc093blByb3BlcnR5KGl0ZW1LZXkpKSB7XHJcbiAgICAgICAgICBpbnNlcnQoaSwgaXRlbSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gaWYgcmVtb3ZlIGN1cnJlbnQgc2ltdWxhdGVJdGVtIG1ha2UgaXRlbSBpbiByaWdodCBwbGFjZVxyXG4gICAgICAgICAgLy8gdGhlbiBqdXN0IHJlbW92ZSBpdFxyXG4gICAgICAgICAgdmFyIG5leHRJdGVtS2V5ID0gZ2V0SXRlbUtleShzaW11bGF0ZUxpc3RbaiArIDFdLCBrZXkpXHJcbiAgICAgICAgICBpZiAobmV4dEl0ZW1LZXkgPT09IGl0ZW1LZXkpIHtcclxuICAgICAgICAgICAgcmVtb3ZlKGkpXHJcbiAgICAgICAgICAgIHJlbW92ZVNpbXVsYXRlKGopXHJcbiAgICAgICAgICAgIGorKyAvLyBhZnRlciByZW1vdmluZywgY3VycmVudCBqIGlzIHJpZ2h0LCBqdXN0IGp1bXAgdG8gbmV4dCBvbmVcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGVsc2UgaW5zZXJ0IGl0ZW1cclxuICAgICAgICAgICAgaW5zZXJ0KGksIGl0ZW0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpbnNlcnQoaSwgaXRlbSlcclxuICAgIH1cclxuXHJcbiAgICBpKytcclxuICB9XHJcblxyXG4gIC8vaWYgaiBpcyBub3QgcmVtb3ZlIHRvIHRoZSBlbmQsIHJlbW92ZSBhbGwgdGhlIHJlc3QgaXRlbVxyXG4gIHZhciBrID0gc2ltdWxhdGVMaXN0Lmxlbmd0aCAtIGpcclxuICB3aGlsZSAoaisrIDwgc2ltdWxhdGVMaXN0Lmxlbmd0aCkge1xyXG4gICAgay0tXHJcbiAgICByZW1vdmUoayArIGkpXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZW1vdmUoaW5kZXgpIHtcclxuICAgIHZhciBtb3ZlID0geyBpbmRleDogaW5kZXgsIHR5cGU6IDAgfVxyXG4gICAgbW92ZXMucHVzaChtb3ZlKVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaW5zZXJ0KGluZGV4LCBpdGVtKSB7XHJcbiAgICB2YXIgbW92ZSA9IHsgaW5kZXg6IGluZGV4LCBpdGVtOiBpdGVtLCB0eXBlOiAxIH1cclxuICAgIG1vdmVzLnB1c2gobW92ZSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZVNpbXVsYXRlKGluZGV4KSB7XHJcbiAgICBzaW11bGF0ZUxpc3Quc3BsaWNlKGluZGV4LCAxKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG1vdmVzOiBtb3ZlcyxcclxuICAgIGNoaWxkcmVuOiBjaGlsZHJlblxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENvbnZlcnQgbGlzdCB0byBrZXktaXRlbSBrZXlJbmRleCBvYmplY3QuXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGxpc3RcclxuICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IGtleVxyXG4gKi9cclxuZnVuY3Rpb24gbWFrZUtleUluZGV4QW5kRnJlZShsaXN0LCBrZXkpIHtcclxuICB2YXIga2V5SW5kZXggPSB7fVxyXG4gIHZhciBmcmVlID0gW11cclxuICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgdmFyIGl0ZW0gPSBsaXN0W2ldXHJcbiAgICB2YXIgaXRlbUtleSA9IGdldEl0ZW1LZXkoaXRlbSwga2V5KVxyXG4gICAgaWYgKGl0ZW1LZXkpIHtcclxuICAgICAga2V5SW5kZXhbaXRlbUtleV0gPSBpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmcmVlLnB1c2goaXRlbSlcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIGtleUluZGV4OiBrZXlJbmRleCxcclxuICAgIGZyZWU6IGZyZWVcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEl0ZW1LZXkoaXRlbSwga2V5KSB7XHJcbiAgaWYgKCFpdGVtIHx8ICFrZXkpIHJldHVybiB2b2lkIDY2NlxyXG4gIHJldHVybiB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyA/IGl0ZW1ba2V5XSA6IGtleShpdGVtKVxyXG59XHJcblxyXG5leHBvcnQgeyBsaXN0RGlmZiwgbWFrZUtleUluZGV4QW5kRnJlZSB9XHJcbiIsImltcG9ydCBfIGZyb20gJy4vdXRpbCdcbmltcG9ydCBwYXRjaCBmcm9tICcuL3BhdGNoJ1xuaW1wb3J0IHsgbGlzdERpZmYgfSBmcm9tICcuL2xpc3QtZGlmZidcblxuZnVuY3Rpb24gZGlmZihvbGRUcmVlLCBuZXdUcmVlKSB7XG4gIHZhciBpbmRleCA9IDBcbiAgdmFyIHBhdGNoZXMgPSB7fVxuICBkZnNXYWxrKG9sZFRyZWUsIG5ld1RyZWUsIGluZGV4LCBwYXRjaGVzKVxuICByZXR1cm4gcGF0Y2hlc1xufVxuXG5mdW5jdGlvbiBkZnNXYWxrKG9sZE5vZGUsIG5ld05vZGUsIGluZGV4LCBwYXRjaGVzKSB7XG4gIHZhciBjdXJyZW50UGF0Y2ggPSBbXVxuXG4gIC8vIE5vZGUgaXMgcmVtb3ZlZC5cbiAgaWYgKG5ld05vZGUgPT09IG51bGwpIHtcbiAgICAvLyBSZWFsIERPTSBub2RlIHdpbGwgYmUgcmVtb3ZlZCB3aGVuIHBlcmZvcm0gcmVvcmRlcmluZywgc28gaGFzIG5vIG5lZWRzIHRvIGRvIGFudGhpbmdzIGluIGhlcmVcbiAgICAvLyBUZXh0Tm9kZSBjb250ZW50IHJlcGxhY2luZ1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcob2xkTm9kZSkgJiYgXy5pc1N0cmluZyhuZXdOb2RlKSkge1xuICAgIGlmIChuZXdOb2RlICE9PSBvbGROb2RlKSB7XG4gICAgICBjdXJyZW50UGF0Y2gucHVzaCh7IHR5cGU6IHBhdGNoLlRFWFQsIGNvbnRlbnQ6IG5ld05vZGUgfSlcbiAgICB9XG4gICAgLy8gTm9kZXMgYXJlIHRoZSBzYW1lLCBkaWZmIG9sZCBub2RlJ3MgcHJvcHMgYW5kIGNoaWxkcmVuXG4gIH0gZWxzZSBpZiAoXG4gICAgb2xkTm9kZS50YWdOYW1lID09PSBuZXdOb2RlLnRhZ05hbWUgJiZcbiAgICBvbGROb2RlLmtleSA9PT0gbmV3Tm9kZS5rZXlcbiAgKSB7XG4gICAgLy8gRGlmZiBwcm9wc1xuICAgIHZhciBwcm9wc1BhdGNoZXMgPSBkaWZmUHJvcHMob2xkTm9kZSwgbmV3Tm9kZSlcbiAgICBpZiAocHJvcHNQYXRjaGVzKSB7XG4gICAgICBjdXJyZW50UGF0Y2gucHVzaCh7IHR5cGU6IHBhdGNoLlBST1BTLCBwcm9wczogcHJvcHNQYXRjaGVzIH0pXG4gICAgfVxuICAgIC8vIERpZmYgY2hpbGRyZW4uIElmIHRoZSBub2RlIGhhcyBhIGBpZ25vcmVgIHByb3BlcnR5LCBkbyBub3QgZGlmZiBjaGlsZHJlblxuICAgIGlmICghaXNJZ25vcmVDaGlsZHJlbihuZXdOb2RlKSkge1xuICAgICAgZGlmZkNoaWxkcmVuKFxuICAgICAgICBvbGROb2RlLmNoaWxkcmVuLFxuICAgICAgICBuZXdOb2RlLmNoaWxkcmVuLFxuICAgICAgICBpbmRleCxcbiAgICAgICAgcGF0Y2hlcyxcbiAgICAgICAgY3VycmVudFBhdGNoXG4gICAgICApXG4gICAgfVxuICAgIC8vIE5vZGVzIGFyZSBub3QgdGhlIHNhbWUsIHJlcGxhY2UgdGhlIG9sZCBub2RlIHdpdGggbmV3IG5vZGVcbiAgfSBlbHNlIHtcbiAgICBjdXJyZW50UGF0Y2gucHVzaCh7IHR5cGU6IHBhdGNoLlJFUExBQ0UsIG5vZGU6IG5ld05vZGUgfSlcbiAgfVxuXG4gIGlmIChjdXJyZW50UGF0Y2gubGVuZ3RoKSB7XG4gICAgcGF0Y2hlc1tpbmRleF0gPSBjdXJyZW50UGF0Y2hcbiAgfVxufVxuXG5mdW5jdGlvbiBkaWZmQ2hpbGRyZW4ob2xkQ2hpbGRyZW4sIG5ld0NoaWxkcmVuLCBpbmRleCwgcGF0Y2hlcywgY3VycmVudFBhdGNoKSB7XG4gIHZhciBkaWZmcyA9IGxpc3REaWZmKG9sZENoaWxkcmVuLCBuZXdDaGlsZHJlbiwgJ2tleScpXG4gIG5ld0NoaWxkcmVuID0gZGlmZnMuY2hpbGRyZW5cblxuICBpZiAoZGlmZnMubW92ZXMubGVuZ3RoKSB7XG4gICAgdmFyIHJlb3JkZXJQYXRjaCA9IHsgdHlwZTogcGF0Y2guUkVPUkRFUiwgbW92ZXM6IGRpZmZzLm1vdmVzIH1cbiAgICBjdXJyZW50UGF0Y2gucHVzaChyZW9yZGVyUGF0Y2gpXG4gIH1cblxuICB2YXIgbGVmdE5vZGUgPSBudWxsXG4gIHZhciBjdXJyZW50Tm9kZUluZGV4ID0gaW5kZXhcbiAgXy5lYWNoKG9sZENoaWxkcmVuLCBmdW5jdGlvbihjaGlsZCwgaSkge1xuICAgIHZhciBuZXdDaGlsZCA9IG5ld0NoaWxkcmVuW2ldXG4gICAgY3VycmVudE5vZGVJbmRleCA9XG4gICAgICBsZWZ0Tm9kZSAmJiBsZWZ0Tm9kZS5jb3VudFxuICAgICAgICA/IGN1cnJlbnROb2RlSW5kZXggKyBsZWZ0Tm9kZS5jb3VudCArIDFcbiAgICAgICAgOiBjdXJyZW50Tm9kZUluZGV4ICsgMVxuICAgIGRmc1dhbGsoY2hpbGQsIG5ld0NoaWxkLCBjdXJyZW50Tm9kZUluZGV4LCBwYXRjaGVzKVxuICAgIGxlZnROb2RlID0gY2hpbGRcbiAgfSlcbn1cblxuZnVuY3Rpb24gZGlmZlByb3BzKG9sZE5vZGUsIG5ld05vZGUpIHtcbiAgdmFyIGNvdW50ID0gMFxuICB2YXIgb2xkUHJvcHMgPSBvbGROb2RlLnByb3BzXG4gIHZhciBuZXdQcm9wcyA9IG5ld05vZGUucHJvcHNcblxuICB2YXIga2V5LCB2YWx1ZVxuICB2YXIgcHJvcHNQYXRjaGVzID0ge31cblxuICAvLyBGaW5kIG91dCBkaWZmZXJlbnQgcHJvcGVydGllc1xuICBmb3IgKGtleSBpbiBvbGRQcm9wcykge1xuICAgIHZhbHVlID0gb2xkUHJvcHNba2V5XVxuICAgIGlmIChuZXdQcm9wc1trZXldICE9PSB2YWx1ZSkge1xuICAgICAgY291bnQrK1xuICAgICAgcHJvcHNQYXRjaGVzW2tleV0gPSBuZXdQcm9wc1trZXldXG4gICAgfVxuICB9XG5cbiAgLy8gRmluZCBvdXQgbmV3IHByb3BlcnR5XG4gIGZvciAoa2V5IGluIG5ld1Byb3BzKSB7XG4gICAgdmFsdWUgPSBuZXdQcm9wc1trZXldXG4gICAgaWYgKCFvbGRQcm9wcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBjb3VudCsrXG4gICAgICBwcm9wc1BhdGNoZXNba2V5XSA9IG5ld1Byb3BzW2tleV1cbiAgICB9XG4gIH1cblxuICAvLyBJZiBwcm9wZXJ0aWVzIGFsbCBhcmUgaWRlbnRpY2FsXG4gIGlmIChjb3VudCA9PT0gMCkge1xuICAgIHJldHVybiBudWxsXG4gIH1cblxuICByZXR1cm4gcHJvcHNQYXRjaGVzXG59XG5cbmZ1bmN0aW9uIGlzSWdub3JlQ2hpbGRyZW4obm9kZSkge1xuICByZXR1cm4gbm9kZS5wcm9wcyAmJiBub2RlLnByb3BzLmhhc093blByb3BlcnR5KCdpZ25vcmUnKVxufVxuXG5leHBvcnQgZGVmYXVsdCBkaWZmXG4iLCIgIGltcG9ydCBfIGZyb20gJy4vdXRpbCdcclxuXHJcbi8qKlxyXG4gKiBWaXJ0dWFsLWRvbSBFbGVtZW50LlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gdGFnTmFtZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvcHMgLSBFbGVtZW50J3MgcHJvcGVydGllcyxcclxuICogICAgICAgICAgICAgICAgICAgICAgIC0gdXNpbmcgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlyXHJcbiAqIEBwYXJhbSB7QXJyYXk8RWxlbWVudHxTdHJpbmc+fSAtIFRoaXMgZWxlbWVudCdzIGNoaWxkcmVuIGVsZW1lbnRzLlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBDYW4gYmUgRWxlbWVudCBpbnN0YW5jZSBvciBqdXN0IGEgcGllY2UgcGxhaW4gdGV4dC5cclxuICovXHJcbmZ1bmN0aW9uIEVsZW1lbnQgKHRhZ05hbWUsIHByb3BzLCBjaGlsZHJlbikge1xyXG4gIGlmICghKHRoaXMgaW5zdGFuY2VvZiBFbGVtZW50KSkge1xyXG4gICAgaWYgKCFfLmlzQXJyYXkoY2hpbGRyZW4pICYmIGNoaWxkcmVuICE9IG51bGwpIHtcclxuICAgICAgY2hpbGRyZW4gPSBfLnNsaWNlKGFyZ3VtZW50cywgMikuZmlsdGVyKF8udHJ1dGh5KVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBFbGVtZW50KHRhZ05hbWUsIHByb3BzLCBjaGlsZHJlbilcclxuICB9XHJcblxyXG4gIGlmIChfLmlzQXJyYXkocHJvcHMpKSB7XHJcbiAgICBjaGlsZHJlbiA9IHByb3BzXHJcbiAgICBwcm9wcyA9IHt9XHJcbiAgfVxyXG5cclxuICB0aGlzLnRhZ05hbWUgPSB0YWdOYW1lXHJcbiAgdGhpcy5wcm9wcyA9IHByb3BzIHx8IHt9XHJcbiAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuIHx8IFtdXHJcbiAgdGhpcy5rZXkgPSBwcm9wc1xyXG4gICAgPyBwcm9wcy5rZXlcclxuICAgIDogdW5kZWZpbmVkXHJcblxyXG4gIHZhciBjb3VudCA9IDBcclxuXHJcbiAgXy5lYWNoKHRoaXMuY2hpbGRyZW4sIGZ1bmN0aW9uIChjaGlsZCwgaSkge1xyXG4gICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgRWxlbWVudCkge1xyXG4gICAgICBjb3VudCArPSBjaGlsZC5jb3VudFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2hpbGRyZW5baV0gPSAnJyArIGNoaWxkXHJcbiAgICB9XHJcbiAgICBjb3VudCsrXHJcbiAgfSlcclxuXHJcbiAgdGhpcy5jb3VudCA9IGNvdW50XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZW5kZXIgdGhlIGhvbGQgZWxlbWVudCB0cmVlLlxyXG4gKi9cclxuRWxlbWVudC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy50YWdOYW1lKVxyXG4gIHZhciBwcm9wcyA9IHRoaXMucHJvcHNcclxuXHJcbiAgZm9yICh2YXIgcHJvcE5hbWUgaW4gcHJvcHMpIHtcclxuICAgIHZhciBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV1cclxuICAgIF8uc2V0QXR0cihlbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSlcclxuICB9XHJcblxyXG4gIF8uZWFjaCh0aGlzLmNoaWxkcmVuLCBmdW5jdGlvbiAoY2hpbGQpIHtcclxuICAgIHZhciBjaGlsZEVsID0gKGNoaWxkIGluc3RhbmNlb2YgRWxlbWVudClcclxuICAgICAgPyBjaGlsZC5yZW5kZXIoKVxyXG4gICAgICA6IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNoaWxkKVxyXG4gICAgZWwuYXBwZW5kQ2hpbGQoY2hpbGRFbClcclxuICB9KVxyXG5cclxuICByZXR1cm4gZWxcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRWxlbWVudCBcclxuIiwiaW1wb3J0IF8gZnJvbSAnLi91dGlsJ1xyXG5pbXBvcnQgZGlmZiBmcm9tICcuL2RpZmYnXHJcbmltcG9ydCBwYXRjaCBmcm9tICcuL3BhdGNoJ1xyXG5pbXBvcnQgZWwgZnJvbSAnLi9lbGVtZW50J1xyXG5cclxubGV0IGxpZCA9IGVsKCdsaScsIHsga2V5OiAnZCcsIHN0eWxlOiAnY29sb3I6IHJlZCcgfSwgWydsaSNkJ10pXHJcbmxldCBsaWUgPSBlbCgnbGknLCB7IGtleTogJ2UnLCBzdHlsZTogJ2NvbG9yOmdyZWVuJyB9LCBbJ2xpI2UnXSlcclxubGV0IGxpYSA9IGVsKCdsaScsIHsga2V5OiAnYScsIHN0eWxlOiAnY29sb3I6IGJsdWUnIH0sIFsnbGkjYSddKVxyXG5sZXQgbGliID0gZWwoJ2xpJywgeyBrZXk6ICdiJywgc3R5bGU6ICdjb2xvcjogeWVsbG93JyB9LCBbJ2xpI2InXSlcclxubGV0IGxpYyA9IGVsKCdsaScsIHsga2V5OiAnYycsIHN0eWxlOiAnY29sb3I6IG9yYW5nZScgfSwgWydsaSNjJ10pXHJcbmxldCBsaWYgPSBlbCgnbGknLCB7IGtleTogJ2YnLCBzdHlsZTogJ2NvbG9yOiBwdXJwbGUnIH0sIFsnbGkjZiddKVxyXG5cclxubGV0IG9sZFRyZWUgPSBlbCgndWwnLCB7IGtleTogJ29sZCcgfSwgW2xpYSwgbGliLCBsaWMsIGxpZF0pXHJcbmxldCBuZXdUcmVlID0gZWwoJ3VsJywgeyBrZXk6ICdvbGQnIH0sIFtsaWQsIGxpYSwgbGliLCBsaWNdKVxyXG5cclxudmFyIHJvb3QgPSBvbGRUcmVlLnJlbmRlcigpXHJcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocm9vdClcclxuXHJcbi8vc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbmNvbnNvbGUudGltZSgnc3RhcnQnKVxyXG52YXIgcGF0Y2hlcyA9IGRpZmYob2xkVHJlZSwgbmV3VHJlZSlcclxuY29uc29sZS5sb2cocGF0Y2hlcylcclxucGF0Y2gocm9vdCwgcGF0Y2hlcylcclxuY29uc29sZS50aW1lRW5kKCdzdGFydCcpXHJcbi8vfSwgMTAwMClcclxuXHJcbi8qIGltcG9ydCB7IGxpc3REaWZmIH0gZnJvbSAnLi9saXN0LWRpZmYnXHJcblxyXG52YXIgb2xkTGlzdCA9IFt7IGlkOiAnZCcgfSwgeyBpZDogJ2UnIH0sIHsgaWQ6ICdhJyB9XVxyXG52YXIgbmV3TGlzdCA9IFt7IGlkOiAnYScgfSwgeyBpZDogJ2QnIH0sIHsgaWQ6ICdlJyB9XVxyXG5cclxudmFyIHsgbW92ZXMgfSA9IGxpc3REaWZmKG9sZExpc3QsIG5ld0xpc3QsICdpZCcpICovXHJcbi8vIGBtb3Zlc2AgaXMgYSBzZXF1ZW5jZSBvZiBhY3Rpb25zIChyZW1vdmUgb3IgaW5zZXJ0KTpcclxuLy8gdHlwZSAwIGlzIHJlbW92aW5nLCB0eXBlIDEgaXMgaW5zZXJ0aW5nXHJcbi8vIG1vdmVzOiBbXHJcbi8vICAge2luZGV4OiAzLCB0eXBlOiAwfSxcclxuLy8gICB7aW5kZXg6IDAsIHR5cGU6IDEsIGl0ZW06IHtpZDogXCJjXCJ9fSxcclxuLy8gICB7aW5kZXg6IDMsIHR5cGU6IDB9LFxyXG4vLyAgIHtpbmRleDogNCwgdHlwZTogMSwgaXRlbToge2lkOiBcImZcIn19XHJcbi8vICBdXHJcblxyXG4vKiBtb3Zlcy5mb3JFYWNoKGZ1bmN0aW9uKG1vdmUpIHtcclxuICBpZiAobW92ZS50eXBlID09PSAwKSB7XHJcbiAgICBvbGRMaXN0LnNwbGljZShtb3ZlLmluZGV4LCAxKSAvLyB0eXBlIDAgaXMgcmVtb3ZpbmdcclxuICB9IGVsc2Uge1xyXG4gICAgb2xkTGlzdC5zcGxpY2UobW92ZS5pbmRleCwgMCwgbW92ZS5pdGVtKSAvLyB0eXBlIDEgaXMgaW5zZXJ0aW5nXHJcbiAgfVxyXG59KSAqL1xyXG5cclxuLy8gbm93IGBvbGRMaXN0YCBpcyBlcXVhbCB0byBgbmV3TGlzdGBcclxuLy8gW3tpZDogXCJjXCJ9LCB7aWQ6IFwiYVwifSwge2lkOiBcImJcIn0sIHtpZDogXCJlXCJ9LCB7aWQ6IFwiZlwifV1cclxuLyogY29uc29sZS5sb2coJ21vdmVzOicsIG1vdmVzKVxyXG5jb25zb2xlLmxvZygnb2xkTGlzdCcsIG9sZExpc3QpICovXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=